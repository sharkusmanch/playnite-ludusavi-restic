on:
  - pull_request

name: Main

jobs:
  pre-commit:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-python@v6
        with:
          python-version: '3.14'
      - run: |
          pip install pre-commit
          dotnet tool install -g dotnet-format
          pre-commit run --all-files --show-diff-on-failure

  build:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v6

      - uses: robinraju/release-downloader@v1.12
        id: download_playnite
        with:
          repository: "JosefNemec/Playnite"
          latest: true
          tarBall: false
          zipBall: false
          fileName: "Playnite*.zip"
          out-file-path: playnite
          extract: true

      - run: |
          dotnet build src -c Release

  test:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v6

      - run: |
          dotnet test tests/LudusaviRestic.Tests.csproj
